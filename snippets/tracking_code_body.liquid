{% assign shopify_ID = 'shopify_us' %}
{% assign server_url = 'https://gtm.bullymax.com/' %}
{% assign gtm_id = 'GTM-5SXBBH' %}
{% assign gads_id = 'AW-1027822635' %}
{% assign ga4_id = 'G-BQTGN4PS4F' %}
{% assign bing_id = '20118449' %}
{% assign pinterest_id = '2618627537941' %}
{% assign tiktok_id = 'CCI7RPBC77U42MHSGN40' %}
{% assign facebook_pixel_id = '586398471519070' %}





<!-- datalayer version -->
<script type="text/javascript" defer>
window.addEventListener('load', function(){
{% if customer %}
    
window.dataLayer.push({
 'event': 'login',
  'ecommerce': {
  'user_id': '{{ customer.id | remove: "'" }}',
  'visitor_type': 'logged_in',
  'tag_source': 'server_side',
  'event_id': uuid(),
  'orders_count': '{{ customer.orders_count }}',
  'total_spent': '{{ customer.total_spent | divided_by: 100 }}',
    'user_data': {
    'email_address': '{{ customer.email }}',
  	'phone_number': '{{ customer.phone }}',
    'address': {
        'first_name': '{{ customer.first_name }}',
        'last_name': '{{ customer.last_name }}',
  		'city': '{{ customer_address.city }}',
        'region': '{{ customer_address.province_code }}',
        'postal_code': '{{ shipping_address.zip }}',
  		'country': '{{ customer_address.country_code }}',
        'street': '{{ customer_address.street }}',  
      },    
    },
},
});
{% else %}
{% endif %}
 
        {% if template contains "product" %}
        Array.prototype.slice.call(document.querySelectorAll('form[action^="/cart/add"] .single-option-selector'))
            .forEach(function(select) {
                select.addEventListener('change', handleVariantChange);
            });

        document.querySelectorAll("form[action^='/cart/add']")[0].addEventListener("submit", function() {
            var variant = getCurrentVariant();




window.dataLayer.push({
 'event': 'add_to_cart',
  'eventModel': {
'currency': ShopifyAnalytics.meta.currency,
'value': product.price / 100,
'user_id': '{{ customer.id | remove: "'" }}',
'tag_source': 'server_side',
'event_id': uuid(),
  'items': [
    { 
{% if variant.sku != '' %}
                'id_sku':  variant.sku,
                'item_id_sku':  variant.sku,
{%else%}
        'id_sku':  variant.id,
		'item_id_sku': variant.id,  
{% endif %}  
	  'variant_id': variant.id,
  	  'id': '{{product.id | remove: "'"}}',
  	  'item_id': '{{product.id | remove: "'"}}',
	  'product_id': '{{product.id | remove: "'"}}',
  	  'item_variant': variant && variant.title && variant.title.replace("'", ''),
      'variant': variant && variant.title && variant.title.replace("'", ''),
  	  'item_name': '{{product.title | remove: "'"}}',
      'name': '{{product.title | remove: "'"}}',
      'shopify_id': '{{product.id | remove: "'"}}_' + variant.id,
      'sku': variant && variant.sku,
      'quantity': document.getElementById("Quantity") ? Number(document.getElementById("Quantity").value) : 1,
      'product_quantity': document.getElementById("Quantity") ? Number(document.getElementById("Quantity").value) : 1,
      'price': product.price / 100,
      'item_brand': product.vendor.replace("'", ''),
      'brand': product.vendor.replace("'", ''),
      'item_category': '{{product.type }}',
      'category': '{{product.type }}',
      'google_business_vertical': 'retail',
    }
  ],
},
ecomm_pagetype: 'cart',
ecomm_prodid: ["{{shopify_ID}}_{{product.id | remove: "'"}}_" + variant.id, {{ product.id }}, variant.id, variant.sku],
id: ["{{shopify_ID}}_{{product.id | remove: "'"}}_" + variant.id, {{ product.id }}, variant.id, variant.sku],
});   
})
{% comment %} 
{% endcomment %}


    {% endif %}





{% if template contains "cart" %}


        var cart = {{ cart | json }};
        var cartitems = cart.items.map(function(item, idx) {
            return {
                'position': idx,
                'index': idx,
{% if item.sku != '' %}
                'id_sku':  item.sku,
                'item_id_sku':  item.sku,
{% else %}
                'id_sku':  item.variant_id,
				'item_id_sku': item.variant_id,  
{% endif %}              
              	'id': item.product_id,
              	'item_id': item.product_id,
              	'product_id': item.product_id,
                'sku': item.sku,
                'variant_id': item.variant_id,
                'item_variant': item.variant_title,
                'variant': item.variant_title,
				'shopify_id': item.product_id + "_" + item.variant_id,
                'name': item.product_title.replace("'", ''),
                'item_name': item.product_title.replace("'", ''),
                'quantity': item.quantity,
                'price': item.price / 100,
                'brand': item.vendor.replace("'", ''),
                'item_brand': item.vendor.replace("'", ''),
      			'item_category': '{{product.type }}',
      			'category': '{{product.type }}',
              	'google_business_vertical': 'retail',

            };
        });

        if (cart.items.length) {
            var cartItemSkus = cart.items.length === 1
                ? cart.items[0].sku
                : cart.items.map(function(item, idx) {
                    return item.sku;
                });

            window.dataLayer.push({
                'cartitems': cartItemSkus
            });
        }

window.dataLayer.push({
 'event': 'cart_view',
  'eventModel': {
'currency': '{{ shop.currency }}',
'value': cart.total_price / 100,
'item_number': cart.item_count,
'user_id': '{{ customer.id | remove: "'" }}',
'tag_source': 'server_side',
'event_id': uuid(),
'items': cartitems,
  },
ecomm_pagetype: 'cart',
ecomm_prodid: [{% for item in cart.items %}"{{shopify_ID}}_{{ item.product_id | remove: "'"}}_{{ item.variant.id }}", "{{ item.product_id | remove: "'"}}", "{{ item.variant_id | remove: "'"}}", "{{ item.sku | remove: "'"}}" {% unless forloop.last %}, {% endunless %}{% endfor %}],
id: [{% for item in cart.items %}"{{shopify_ID}}_{{ item.product_id | remove: "'"}}_{{ item.variant.id }}", "{{ item.product_id | remove: "'"}}", "{{ item.variant_id | remove: "'"}}", "{{ item.sku | remove: "'"}}" {% unless forloop.last %}, {% endunless %}{% endfor %}],

});     

  



    {% endif %}

document.addEventListener('rebuy:cart.add', function(event){ 
        var cart = {{ cart | json }};
        var cartitems = cart.items.map(function(item, idx) {
            return {
                'position': idx,
                'index': idx,
{% if item.sku != '' %}
                'id_sku':  item.sku,
                'item_id_sku':  item.sku,
{% else %}
                'id_sku':  item.variant_id,
				'item_id_sku': item.variant_id,  
{% endif %}              
              	'id': item.product_id,
              	'item_id': item.product_id,
              	'product_id': item.product_id,
                'sku': item.sku,
                'variant_id': item.variant_id,
                'item_variant': item.variant_title,
                'variant': item.variant_title,
				'shopify_id': item.product_id + "_" + item.variant_id,
                'name': item.product_title.replace("'", ''),
                'item_name': item.product_title.replace("'", ''),
                'quantity': item.quantity,
                'price': item.price / 100,
                'brand': item.vendor.replace("'", ''),
                'item_brand': item.vendor.replace("'", ''),
      			'item_category': '{{product.type }}',
      			'category': '{{product.type }}',
              	'google_business_vertical': 'retail',

            };
        });

        if (cart.items.length) {
            var cartItemSkus = cart.items.length === 1
                ? cart.items[0].sku
                : cart.items.map(function(item, idx) {
                    return item.sku;
                });

            window.dataLayer.push({
                'cartitems': cartItemSkus
            });
        }

window.dataLayer.push({
 'event': 'smart_cart_view',
  'eventModel': {
'currency': '{{ shop.currency }}',
'value': cart.total_price / 100,
'item_number': cart.item_count,
'user_id': '{{ customer.id | remove: "'" }}',
'tag_source': 'server_side',
'event_id': uuid(),
'items': cartitems,
  },
ecomm_pagetype: 'cart',
ecomm_prodid: [{% for item in cart.items %}"{{shopify_ID}}_{{ item.product_id | remove: "'"}}_{{ item.variant.id }}", "{{ item.product_id | remove: "'"}}", "{{ item.variant_id | remove: "'"}}", "{{ item.sku | remove: "'"}}" {% unless forloop.last %}, {% endunless %}{% endfor %}],
id: [{% for item in cart.items %}"{{shopify_ID}}_{{ item.product_id | remove: "'"}}_{{ item.variant.id }}", "{{ item.product_id | remove: "'"}}", "{{ item.variant_id | remove: "'"}}", "{{ item.sku | remove: "'"}}" {% unless forloop.last %}, {% endunless %}{% endfor %}],

}); 
});  
 
   
}, false);
  


</script>