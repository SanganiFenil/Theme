{% assign shopify_ID = 'shopify_us' %}
{% assign server_url = 'https://gtm.bullymax.com/' %}
{% assign gtm_id = 'GTM-5SXBBH' %}
{% assign gads_id = 'AW-1027822635' %}
{% assign ga4_id = 'G-BQTGN4PS4F' %}
{% assign bing_id = '20118449' %}
{% assign pinterest_id = '2618627537941' %}
{% assign tiktok_id = 'CCI7RPBC77U42MHSGN40' %}
{% assign facebook_pixel_id = '586398471519070' %}

<script>
	function uuid() {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
    return v.toString(16);
  });
}
</script>
<script>
     {% if template contains "product" %}
        var product = {{ product | json }};

        function getCurrentVariant() {
            var selects = document.querySelectorAll('form[action^="/cart/add"] select[name="id"]');
            if (!selects.length) return product.variants[0];
            var selectedId = selects[0].value;
            return product.variants.filter(function(variant) {
                return variant.id == selectedId;
            })[0];
        }


        var variant = getCurrentVariant();


window.dataLayer = window.dataLayer || [];
window.dataLayer.push({
 'event': 'product_page',
  'ecommerce': {
'currency': '{{ shop.currency }}',
    'test_url': 'https.gtm.' + window.location.host,
'value': product.price / 100,
'user_id': '{{ customer.id | remove: "'" }}',
'tag_source': 'server_side',
'event_id': uuid(),
  'items': [
    { 
{% if variant.sku != '' %}
                'id_sku':  variant.sku,
                'item_id_sku':  variant.sku,
{%else%}
        'id_sku':  variant.id,
		'item_id_sku': variant.id,  
{% endif %}  
	  'variant_id': variant.id,
	  'id': '{{product.id | remove: "'"}}',
	  'item_id': '{{product.id | remove: "'"}}',
  	  'item_variant': variant && variant.title && variant.title.replace("'", ''),
     'variant': variant && variant.title && variant.title.replace("'", ''),
  	  'item_name': '{{product.title | remove: "'"}}',
      'name': '{{product.title | remove: "'"}}',
      'shopify_id': '{{product.id | remove: "'"}}_' + variant.id,
      'sku': variant && variant.sku,
      'quantity': 1,
      'product_quantity': 1,
      'price': product.price / 100,
      'item_brand': product.vendor.replace("'", ''),
      'brand': product.vendor.replace("'", ''),
      'item_category': '{{product.type }}',
      'category': '{{product.type }}',
      'google_business_vertical': 'retail',
    }
  ],
},
ecomm_pagetype: 'product',
ecomm_prodid: ["{{shopify_ID}}_{{product.id | remove: "'"}}_" + variant.id, {{ product.id }}, variant.id, variant.sku],
id: ["{{shopify_ID}}_{{product.id | remove: "'"}}_" + variant.id, {{ product.id }}, variant.id, variant.sku],
});
  
  
  var handleVariantChange = function(event) {
            var variant = getCurrentVariant();

window.dataLayer = window.dataLayer || [];        
window.dataLayer.push({
 'event': 'product_page',
  'ecommerce': {
'currency': '{{ shop.currency }}"',
    'test_url': 'https.gtm.' + window.location.host,
'value': product.price / 100,
'user_id': '{{ customer.id | remove: "'" }}',
'tag_source': 'server_side',
'event_id': uuid(),
  'items': [
    { 
{% if variant.sku != '' %}
                'id_sku':  variant.sku,
                'item_id_sku':  variant.sku,
{%else%}
        'id_sku':  variant.id,
		'item_id_sku': variant.id,  
{% endif %}  
	  'variant_id': variant.id,
	  'id': '{{product.id | remove: "'"}}',
	  'item_id': '{{product.id | remove: "'"}}',
  	  'item_variant': variant && variant.title && variant.title.replace("'", ''),
      'variant': variant && variant.title && variant.title.replace("'", ''),
  	  'item_name': "{{product.title | remove: "'"}}",
      'name': '{{product.title | remove: "'"}}',
      'shopify_id': '{{product.id | remove: "'"}}_' + variant.id,
      'sku': variant && variant.sku,
      'quantity': 1,
      'product_quantity': 1,
      'price': product.price / 100,
      'item_brand': product.vendor.replace("'", ''),
      'brand': product.vendor.replace("'", ''),
      'item_category': '{{product.type }}',
      'category': '{{product.type }}',
      'google_business_vertical': 'retail',
    }
  ],
},
ecomm_pagetype: 'product',
ecomm_prodid: ["{{shopify_ID}}_{{product.id | remove: "'"}}_" + variant.id, {{ product.id }}, variant.id, variant.sku],
id: ["{{shopify_ID}}_{{product.id | remove: "'"}}_" + variant.id, {{ product.id }}, variant.id, variant.sku],
}); 
     
        };

{% endif %}
</script>







